# 数据库事务的四大特性（ACID）以及隔离级别

## 一、四大特性（ACID）

数据库事务是访问并可能操作各种数据项的一个数据库操作序列

1、**原子性Atomicity**：事务内包含的所有操作要么全部成功，要么全部失败回滚。**实现：undo log**

2、**一致性Consistency**：一个事务执行前和执行后都处于一致性状态。例如：A和B进行转账操作，A有200块钱，B有300块钱；当A转了100块钱给B之后，他们2个人的总额还是500块钱，不会改变。**实现：其他3个特性共同实现一致性**

3、**隔离性Isolation**：当多个用户并发访问数据库时，数据库为每个用户开启一个事务，多个并发事务之间要相互隔离。即要达到这么一种效果：对于任意两个并发的事务T1和T2，在事务T1看来，T2要么在T1开始之前就已经结束，要么在T1结束之后才开始，这样每个事务都感觉不到有其他事务在并发地执行。**实现：隔离级别+MVCC**

4、**持久性Durability**：一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的。**实现：redo log**

## 二、隔离级别

1、**READ UNCOMMITTED（未提交读）**：事务可以读取未提交的数据，称为**脏读**

2、**READ COMMITTED（提交读）**：在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据并提交了事务，那么在第一个事务中，两次读取的数据就可能不一致，称为**不可重复读**（Sql Server及Oracle的默认隔离级别）

3、**REPEATABLE READ（可重复读）**：当事务A在读取某个范围内的记录后，事务B又在该范围内插入了新的记录，当事务A再次读取该范围的记录时，会无法查询到新插入的数据，但却能够对这个新插入的记录进行修改，称为**幻读**（**MySQL的默认隔离级别**）

至于产生这种现象的原因，可以简单的理解为：事务A在进行**第一次查询操作后**，产生了一个数据库的快照，这个快照可以让数据库在进行其他写操作时实现并发读操作。读时不是真正的在读数据库，而是读这个快照。这样做的目的是**提高并发效率，但会造成一定的数据误差**

详细内容可以了解下MVCC

[MVCC底层原理](https://gitee.com/KKKLxxx/study-notes/blob/master/MySQL/MVCC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86.md "MVCC底层原理")

4、**SERIALIZABLE（串行化）**：在读取每一行数据都加锁，所以可能导致大量的超时和锁争用问题

## 三、如何解决脏读、不可重复读、幻读

对于脏读和不可重复读，**提高隔离级别**即可

对于幻读，如果再提高隔离级别，会大大降低性能，所以可以采用**间隙锁**解决

