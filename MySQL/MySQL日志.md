# MySQL日志

##  一、bin log（二进制日志）

### 1、作用

用于主从复制，从库利用主库上的bin log进行重播，实现主从同步

也可用于恢复数据

### 2、记录模式

**1、statement（默认）**

是一种逻辑日志，即保存的是增删改的SQL语句

优点：日志量小，所以恢复速度也较快

缺点：一些特殊的修改无法被记录，比如触发器

**2、row**

记录每行的修改

优点：日志记录更全面

缺点：空间占用大，假如一张表的结构发生了改变，那么会对每条数据增加一条日志

**3、mixed**

statement与row的混合，对于sql修改的以statement记录，对于触发器等修改的以row记录

优点：日志空间更小，记录也更完整

### 3、持久化时间

在事务提交时一次性写入

### 4、清除时间

根据参数expire_logs_days配置

## 二、redo log（重做日志）

### 1、作用

保证数据库事务的持久性。当数据库突发故障导致数据未写入时，可在数据库重启后根据redo log重做，以保证事务的持久性

### 2、记录模式

是一种物理日志，记录的是物理数据页面的修改的信息

### 3、持久化时间

事务执行过程中定期写入

### 4、清除时间

数据库的数据完成持久化（写入到磁盘）后即可释放

## 三、undo log（回滚日志）

### 1、作用

保证事务原子性，并为MVCC提供实现基础

### 2、记录模式

是一种逻辑日志，与bin log不同的是保存增删改相反的SQL语句

### 3、持久化时间

实时产生，但只保存在内存中，不会持久化到磁盘中。数据库宕机恢复由redo log负责

### 4、清除时间

当事务提交之后，undo log并不能立刻被删除，而是放入待清理列表。当被判断为不被MVCC需要时即可清除

## 四、bin log与redo log对比

两者都可以用于恢复数据，但

bin是数据库层面的，redo是InnoDB提供的

bin是逻辑日志，redo是物理日志，所以redo的恢复效率更高



还有一种慢查询日志，会在讲慢查询时单独介绍