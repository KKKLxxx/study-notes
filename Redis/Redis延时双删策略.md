# Redis延时双删策略

## 一、作用

传统的先更新数据库再删缓存的策略，会在一种情况下查到旧数据：在请求1更新数据库→删除缓存这段时间内，如果请求2查询数据，那么请求2查询到的实际上是redis中的旧数据

延时双删策略就是为了**保证读请求结束，写请求可以删除读请求造成的缓存脏数据**

## 二、执行过程

1、删除缓存（第一次删除）

2、更新mysql

3、延时xxx秒（根据业务决定，要确保读请求结束）

4、删除缓存（第二次删除）

## 三、延时的实现方式

### 1、消息队列

可以借助消息队列实现延迟消费

### 2、订阅binlog

消息队列的方式对代码有一定的入侵性，也可以通过订阅binlog，根据binlog获取redis中的key，然后再删除。由于需要延迟消费，所以还是需要通过消息队列实现