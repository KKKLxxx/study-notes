# 缓存更新策略

**要根据数据一致性要求和维护成本综合考虑**

## 一、**容量满删除**

在缓存容量达到最大值时使用LRU等算法使部分缓存失效。数据一致性要求低，但实现简单

## 二、**超时更新**

对数据一致性要求不高的业务可简单地设置超时时间

## 三、**主动更新**

1、**先更新数据库，再删缓存（推荐）**

**失效场景**：A查询，B更新。A缓存未命中，准备将数据库中的数据放入缓存。此时B更新了数据库并删除缓存，A将旧数据放入了缓存导致以后的数据仍为旧数据

2、先删缓存，再更新数据库

**失效场景**：A查询，B更新。B先把缓存删除，A缓存未命中，将旧数据重新添加到缓存，导致以后的数据仍为旧数据

因为对缓存的操作速度更快，可以认为方案1的失效场景发生的概率更小

3、调用者只操作缓存，由后台线程异步将缓存更新到数据库

这种方案保持了缓存和数据库的最终一致性，但是可靠性较低，一般不予考虑