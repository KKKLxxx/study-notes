# 缓存穿透、缓存击穿、缓存雪崩

## 一、缓存穿透

高并发访问并不存在的key，由于不可能缓存命中，导致每次都会访问数据库，从而导致数据库崩溃

**解决方案**：

- 布隆过滤器：（HashMap空间占用太大）布隆过滤器维护一个二进制数组，通过n个hash函数对key计算n个哈希值，并对数组长度取模，得到应置1的位置，对于不存在的值直接拒绝查找。有一定的误判率，只会将不存在的误判为存在，而不会反过来

## 二、缓存击穿

高并发访问一个存在的热点key，但此时缓存失效，仍会每次都访问数据库

所以缓存击穿要解决的问题就是在缓存失效到恢复缓存这段时间，将请求阻塞，防止所有请求都访问数据库

**解决方案**：

- 热点key不要设置过期时间

- 通过互斥锁来保证只有一个请求访问数据库并更新缓存（要设置过期时间，防止长时间不释放），其他请求阻塞或返回空值

## 三、缓存雪崩

缓存服务宕机或大量缓存同时失效，导致数据库访问量过大

**解决方案**：

应对缓存服务宕机问题：

- 通过建立集群确保缓存服务高可用
- 通过熔断或者限流机制，防止数据库访问量过大

应对大量缓存同时失效问题：

- 通过随机数将过期时间尽量分散
- 互斥锁

