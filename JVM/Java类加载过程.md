# Java类加载过程

## 一、类的生命周期

类的生命周期可以用一张图概括

<img src="https://raw.githubusercontent.com/KKKLxxx/img-host/master/20210905203541338.png" style="zoom: 67%;" />

## 二、类加载机制

Java虚拟机把描述类的数据从`.class`文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这个过程被称作虚拟机的类加载机制

## 三、类加载过程

### 1、加载

Java源代码被编译器编译成`.class`的字节码文件，然后由`ClassLoader`负责将这些`.class`文件给加载到JVM中去生成对应`Class`对象，这个加载过程用到了[双亲委派机制](https://gitee.com/KKKLxxx/study-notes/blob/master/JVM/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6.md "双亲委派机制")

### 2、连接

将加载到JVM中的二进制字节流的类数据信息合并到JVM的运行时状态中，分为验证、准备、解析三部分

#### 1、验证

验证的内容包括：

- 文件格式：字节流是否符合`.class`文件格式

- 语义：比如`final`方法是否被继承

- 字节码：如保证任何跳转指令都不会跳转到方法体以外的字节码指令上

- 符号引用：符号引用中通过字符串描述的全限定名是否能找到对应的类

#### 2、准备

为类中的静态变量分配内存空间，并设置初始零值

#### 3、解析

将常量池中的符号引用替换为直接引用。因为在编译时，Java类并不知道所引用的类的实际地址，因此只能使用符号引用来代替

### 3、初始化

将所有被`static`修饰的代码执行一遍，如果是变量，则对变量赋值，如果是代码块，则执行代码块

JVM保证父类优先初始化以及多线程时仅有一个线程对一个类进行初始化操作，其他线程则等待