# Kafka消息持久化机制

消息队列往往需要持久化来保证即使消费者某个时刻不在线，但在线之后仍能够收到消息。Kafka通过将消息保存在磁盘中实现持久化，但是我们知道Kafka的一大亮点就是吞吐量大，而磁盘操作通常是很慢的，这要如何保证吞吐量呢？

Kafka的每个Topic可以分为多个Partition，而每个Partition在持久化时又会分为多个segment，每个segment存储一定量的数据。在添加新数据时，Kafka会以追加的方式添加，这将对磁盘的随机IO变为了顺序IO，使得IO速度大大提升，甚至高于对内存随机IO的速度。在超过保存时间或者容量限制之后，会删除最旧的segment，这样直接删除一整个文件也能够使速度得到提升

当消费者重新上线时，可以通过自己对应的offset来定位应该读取的消息的位置

