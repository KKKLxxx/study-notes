# HTTP发展过程

## 一、HTTP/1.0

### **缺陷**：

**短连接**：每个请求使用单独的TCP连接，都要进行连接的建立和释放，服务器必须维持多个连接

## 二、HTTP/1.1

### **改进**：

1、**长连接**：一个TCP连接可以处理多个请求

2、**管道传输**（但默认不开启）：在同一个TCP连接里发起多个请求时，只要第一个请求发出去了，不必等待响应，就可以发第二个请求出去，可以减少整体的响应时间

![管道网络传输](https://raw.githubusercontent.com/KKKLxxx/img-host/master/202601051345384.png)

### **缺陷**：

**队头阻塞**：多个请求在同一个TCP管道中传输的，当出现丢包时，后面的所有数据包都要等待这个包重传，造成了阻塞。可细分为请求的队头阻塞和响应的队头阻塞

管道传输可以解决请求的队头阻塞，但仍存在响应的队头阻塞的问题

### 优化思路

1、**使用缓存**：即通过强制缓存/协商缓存等方式，从本地磁盘获取资源

2、**减少请求次数**：及时修改请求地址，减少重定向次数；将多个小资源（如多个图片）合并成大资源；按需请求，而非一次性加载所有内容

3、**减小数据大小**：对文本等内容进行无损压缩，对音视频等内容进行有损压缩

## 三、HTTP/2.0

### **改进**：

1、**首部压缩**：若同时发送的多个请求的首部相同，可使用HPACK压缩算法压缩首部，节省请求头占用的带宽

2、**二进制传输**：http1.x采用纯文本传输，http2.0采用二进制传输，计算机收到报文后可直接处理，而无需将文本转为二进制，提高传输效率

3、**并发传输**：http2.0将消息分割为帧，并通过不同的流传输，一个TCP连接可以传输多个流。同一个流中的帧有序，不同流之间的帧可以无序

4、**服务端推送**：服务端根据客户端的请求，提前返回多个响应，推送额外的资源给客户端

### **缺陷**：

1、**连接时间过长**：TCP三次握手和TLS握手导致

2、**队头阻塞**：并发传输只解决了http层面的队头阻塞，仍然存在tcp层面的队头阻塞。因为http2.0的底层传输协议仍是tcp，所以应用层的http消息虽然可以乱序发送，但底层的tcp传输仍要保持顺序

并且http2.0将同一域名下的连接都复用同一个TCP连接，虽然解决了http1.1中一个域名最多6个TCP连接的限制，但是发生队头阻塞时造成的影响可能更加严重

## 四、HTTP/3.0

### **改进**：

1、**更快建立连接**：http3.0基于UDP，并通过“QUIC”协议在应用层使UDP实现类似TCP的可靠传输，节省了建立连接的时间

2、**解决队头阻塞**：因为udp传输过程中不需要保证有序，http3.0中，一个流中的数据包阻塞只会阻塞当前流，而不会影响其他流，而http 2.0中会阻塞所有流。所以彻底解决了队头阻塞问题

3、**连接迁移**：移动设备从 4G 网络环境切换到 WiFi 时，由于 TCP 是基于四元组（源 IP、源端口、目的 IP、目的端口）来确认一条 TCP 连接的，那么网络环境变化后，就会导致 IP 地址或端口变化，于是 TCP 只能断开连接，然后再重新建立连接，切换网络环境的成本高

QUIC 协议没有用四元组的方式来绑定连接，而是通过「连接 ID 」来标记通信的两个端点，因此即使移动设备的网络变化后，导致 IP 地址变化了，只要仍保有上下文信息（比如连接 ID、TLS 密钥等），就可以“无缝”地复用原连接，消除重连的成本

