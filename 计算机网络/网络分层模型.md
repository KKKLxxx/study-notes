# 网络分层模型

## 一、OSI七层模型

### 1、应用层

专注于为用户提供应用功能，屏蔽数据传输的细节，如**HTTP（超文本传输）、SMTP（邮件传输）、FTP（文件传输）、DNS（域名解析）**

### 2、表示层

定义信息传输的语法和语义

### 3、会话层

允许不同机器上的用户建立会话，对话控制

### 4、传输层

1、**实现端到端传输**：通过端口指定具体通信的两个应用

2、**常见协议**：TCP、UDP

### 5、网络层

1、**网络互联**：网络有很多分类，比如个域网、局域网、广域网、IPv4/6等，网络层可以通过隧道等方式跨过不同类型的网络

2、**路由选择**：将数据包从源机器路由到目标机器，数据包往往需要多跳才能到达目的地

3、**拥塞控制**：网络中存在太多数据包导致数据包被延迟或丢失，从而降低了传输性能，这种情况称为拥塞。显式拥塞通知通过回传抑制包来显式通知源机器降低发送速率；隐式拥塞通知通过丢包的方式隐式通知源机器降低发送速率

4、**流量整形**：通过漏桶、令牌桶等算法将突发流量进行平均，以提高服务质量，类似于流量控制

5、**常见协议**：IP、ICMP（互联网控制消息协议，当IP包未成功传输时，会通过ICMP传递失败原因；ping的底层协议）、ARP（地址解析协议，维护一张ARP表，用于存储IP地址和MAC地址的映射关系）

### 6、数据链路层

1、**将数据封装成帧**：数据链路层将连续的比特流拆分为多个帧，每个帧的结构包括：帧头、负载、帧尾。帧头帧尾主要用于标识一个帧的开始和结束，并且提供差错校验功能。在发现有数据传送错误时，只需将有差错的帧再次传送，而不需要将全部数据的比特流进行重传，这就在传送效率上将大大提高

2、**进行局域网内的数据交换**：通过ARP协议确定局域网（即以太网）中的发送方和接收方

3、**差错控制**：为了确保每一帧都被接收方收到，并保持正确的顺序，可以通过超时重传+帧序号的方式解决，若接收方收到重复帧，可以直接将该帧丢弃。差错控制又可分为差错检验与纠正，检验可通过汉明码，纠正可通过CRC（循环冗余校验）等

### 7、物理层

利用物理传输介质为数据链路层提供物理连接，传输比特流

## 二、TCP/IP四层模型

1、应用层

2、传输层

3、网络层

4、链路层

## 三、五层模型

1、应用层

2、传输层

3、网络层

4、数据链路层

5、物理层

## 四、流量控制与拥塞控制的区别

**流量控制**：由接收方主导，通过发送接收窗口向发送方反馈接受能力，防止接收方缓冲区溢出，主要考虑的是各端之间的发送、接收处理能力。通过滑动窗口控制，Nagle算法避免发送方发送小包（积累足够的数据后再一起发送），Clark算法解决接收方通告小接收窗口导致发送方发送小数据包的问题（等到缓冲区足够大时才反馈接收窗口）

**拥塞控制**：由发送方主导，通过主动探测丢包情况并调整拥塞窗口，降低网络的负载，是一个全局性的过程，涉及到所有的主机、路由器，以及与降低网络传输性能有关的所有因素。用慢启动+AIMD（加性增，乘性减）+快重传（3个重复ACK）等机制维护拥塞窗口

**发送窗口 = min(接收窗口, 拥塞窗口)**

## 五、模型分层的优缺点

### 优点

将整个网络的功能进行了划分，每一层只用实现自己的功能，并向上一层提供接口，内部可以方便地修改具体的实现。每层不需要关心其他层的实现，只需要调用。整体上简化了网络协议的实现

### 缺点

每一层的传输和包装带来了一定的性能损失